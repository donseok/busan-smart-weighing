# ─── 애플리케이션 기본 설정 ───
spring:
  application:
    name: weighing-api  # 애플리케이션 이름

  # ─── 데이터베이스 설정 (PostgreSQL) ───
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:weighing}  # 데이터베이스 연결 URL
    username: ${DB_USERNAME:weighing}  # 데이터베이스 사용자명
    password: ${DB_PASSWORD:weighing}  # 데이터베이스 비밀번호
    driver-class-name: org.postgresql.Driver  # JDBC 드라이버 클래스
    hikari:
      minimum-idle: 10  # 최소 유휴 커넥션 수
      maximum-pool-size: 30  # 최대 커넥션 풀 크기
      connection-timeout: 5000  # 커넥션 획득 타임아웃 (밀리초)

  # ─── JPA / Hibernate 설정 ───
  jpa:
    hibernate:
      ddl-auto: validate  # DDL 자동 생성 전략 (validate: 스키마 검증만 수행)
    open-in-view: false  # OSIV 비활성화 (지연 로딩 트랜잭션 외부 방지)
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect  # Hibernate 방언
        format_sql: true  # SQL 포맷팅 출력
        jdbc:
          time_zone: Asia/Seoul  # JDBC 타임존 (한국 표준시)

  # ─── Redis 설정 ───
  data:
    redis:
      host: ${REDIS_HOST:localhost}  # Redis 서버 호스트
      port: ${REDIS_PORT:6379}  # Redis 서버 포트
      password: ${REDIS_PASSWORD:}  # Redis 비밀번호
      timeout: 3000ms  # Redis 연결 타임아웃

  # ─── Jackson JSON 직렬화 설정 ───
  jackson:
    time-zone: Asia/Seoul  # JSON 날짜 타임존 (한국 표준시)
    date-format: yyyy-MM-dd'T'HH:mm:ssXXX  # 날짜 출력 형식 (ISO 8601)
    serialization:
      write-dates-as-timestamps: false  # 날짜를 타임스탬프 대신 문자열로 직렬화
    property-naming-strategy: SNAKE_CASE  # JSON 프로퍼티 네이밍 전략 (snake_case)

# ─── JWT 인증 토큰 설정 ───
jwt:
  secret: ${JWT_SECRET:dGhpcyBpcyBhIHZlcnkgc2VjdXJlIGtleSBmb3IgdGVzdGluZyBwdXJwb3NlcyBvbmx5IGRvIG5vdCB1c2UgaW4gcHJvZHVjdGlvbg==}  # JWT 서명 비밀키 (Base64 인코딩)
  access-token-expiration: 1800000  # 액세스 토큰 만료 시간 (30분, 밀리초)
  refresh-token-expiration: 604800000  # 리프레시 토큰 만료 시간 (7일, 밀리초)
  issuer: weighing-api  # JWT 발급자

# ─── OTP 인증 설정 ───
otp:
  code-length: 6  # OTP 코드 자릿수
  ttl-seconds: 300  # OTP 유효 시간 (5분, 초)
  max-failed-attempts: 3  # OTP 최대 실패 허용 횟수

# ─── FCM 푸시 알림 설정 ───
fcm:
  enabled: ${FCM_ENABLED:false}  # FCM 푸시 알림 활성화 여부
  service-account-file: ${FCM_SERVICE_ACCOUNT_FILE:}  # Firebase 서비스 계정 파일 경로

# ─── 내부 API 설정 ───
api:
  internal-key: ${API_INTERNAL_KEY:test-internal-key}  # 내부 API 인증 키

# ─── CORS (교차 출처 리소스 공유) 설정 ───
cors:
  allowed-origins: ${CORS_ORIGIN_WEB:http://localhost:3000}  # 허용 출처 (프론트엔드 URL)
  allowed-methods: GET,POST,PUT,DELETE,OPTIONS  # 허용 HTTP 메서드
  allowed-headers: "*"  # 허용 요청 헤더
  allow-credentials: true  # 자격 증명(쿠키) 포함 허용
  max-age: 3600  # Preflight 캐시 시간 (1시간, 초)

# ─── AES 암호화 설정 ───
encryption:
  aes-key: ${AES_SECRET_KEY:YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY=}  # AES 암호화 키 (Base64 인코딩)

# ─── Actuator 모니터링 설정 ───
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus  # 노출할 Actuator 엔드포인트

# ─── 로깅 설정 ───
logging:
  level:
    com.dongkuk.weighing: DEBUG  # 애플리케이션 로그 레벨
